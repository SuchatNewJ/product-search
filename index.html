<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ - EZ Store</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 14px;
            opacity: 0.95;
            margin-top: 5px;
        }

        .header .tips {
            font-size: 12px;
            opacity: 0.85;
            margin-top: 8px;
            background: rgba(255,255,255,0.1);
            padding: 8px 15px;
            border-radius: 20px;
            display: inline-block;
        }

        .setup-box {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            margin-bottom: 20px;
        }

        .setup-title {
            font-size: 22px;
            font-weight: bold;
            margin-bottom: 20px;
            color: #667eea;
            text-align: center;
        }

        .instructions {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-size: 14px;
            line-height: 1.8;
        }

        .instructions h4 {
            color: #667eea;
            margin-bottom: 12px;
            font-size: 16px;
        }

        .instructions ol {
            margin-left: 20px;
        }

        .instructions code {
            background: #e9ecef;
            padding: 2px 8px;
            border-radius: 4px;
            font-family: monospace;
            color: #d63384;
            font-size: 13px;
        }

        .instructions pre {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 12px;
            border-radius: 8px;
            overflow-x: auto;
            font-size: 12px;
            margin: 10px 0;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 600;
            font-size: 15px;
        }

        .input-group input {
            width: 100%;
            padding: 14px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 15px;
            transition: all 0.3s;
        }

        .input-group input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 14px 35px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .btn:active {
            transform: translateY(0);
        }

        .search-box {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            margin-bottom: 30px;
            display: none;
        }

        .search-box.active {
            display: block;
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .search-input-wrapper {
            position: relative;
            margin-bottom: 20px;
        }

        #searchInput {
            width: 100%;
            padding: 18px 50px 18px 20px;
            font-size: 18px;
            border: 3px solid #667eea;
            border-radius: 12px;
            outline: none;
            transition: all 0.3s;
        }

        #searchInput:focus {
            border-color: #764ba2;
            box-shadow: 0 0 0 4px rgba(118, 75, 162, 0.1);
        }

        .search-icon {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            color: #667eea;
            font-size: 24px;
            pointer-events: none;
        }

        .stats {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            justify-content: center;
            margin-bottom: 20px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 35px;
            border-radius: 12px;
            text-align: center;
            min-width: 160px;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .stat-card .number {
            font-size: 36px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-card .label {
            font-size: 14px;
            opacity: 0.95;
        }

        .refresh-btn {
            background: #28a745;
            padding: 12px 25px;
            font-size: 15px;
            width: auto;
            display: inline-block;
        }

        .refresh-btn:hover {
            background: #218838;
        }

        .results {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
        }

        .product-card {
            background: white;
            border-radius: 15px;
            padding: 0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            transition: all 0.3s;
            cursor: pointer;
            border: 2px solid transparent;
            overflow: hidden;
        }

        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.3);
            border-color: #667eea;
        }

        .product-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #999;
            font-size: 60px;
        }

        .product-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .product-image.no-image {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .product-body {
            padding: 20px;
        }

        .product-header {
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        .product-name {
            font-size: 18px;
            font-weight: bold;
            color: #333;
            margin-bottom: 8px;
            line-height: 1.4;
        }

        .product-id {
            font-size: 12px;
            color: #999;
            font-family: monospace;
            background: #f5f5f5;
            padding: 4px 8px;
            border-radius: 4px;
            display: inline-block;
        }

        .product-info {
            display: grid;
            gap: 10px;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
        }

        .info-label {
            color: #666;
            font-size: 14px;
            font-weight: 500;
        }

        .info-value {
            font-weight: bold;
            color: #333;
            font-size: 15px;
        }

        .price {
            color: #e74c3c;
            font-size: 24px;
            font-weight: 900;
        }

        .brand-badge {
            display: inline-block;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 5px 14px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
        }

        .category-badge {
            display: inline-block;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 5px 14px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
        }

        .quantity-badge {
            color: #28a745;
            font-weight: bold;
            background: #d4edda;
            padding: 4px 10px;
            border-radius: 6px;
        }

        .status-message {
            text-align: center;
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
            font-weight: 500;
            font-size: 15px;
        }

        .status-success {
            background: #d4edda;
            color: #155724;
            border: 2px solid #c3e6cb;
        }

        .status-error {
            background: #f8d7da;
            color: #721c24;
            border: 2px solid #f5c6cb;
        }

        .status-info {
            background: #d1ecf1;
            color: #0c5460;
            border: 2px solid #bee5eb;
        }

        .no-results {
            text-align: center;
            color: white;
            font-size: 20px;
            padding: 60px 20px;
            background: rgba(255,255,255,0.15);
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }

        .no-results-icon {
            font-size: 60px;
            margin-bottom: 15px;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: white;
        }

        .spinner {
            border: 4px solid rgba(255,255,255,0.3);
            border-top: 4px solid white;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2em;
            }
            
            .results {
                grid-template-columns: 1fr;
            }

            .stats {
                flex-direction: column;
            }

            .stat-card {
                width: 100%;
            }

            .product-card {
                padding: 15px;
            }
        }

        @media (max-width: 480px) {
            body {
                padding: 10px;
            }

            .header h1 {
                font-size: 1.6em;
            }

            .setup-box, .search-box {
                padding: 20px;
            }

            #searchInput {
                font-size: 16px;
                padding: 15px 45px 15px 15px;
            }

            .product-name {
                font-size: 16px;
            }

            .price {
                font-size: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîç ‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h1>
            <p>‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏£‡∏ß‡∏î‡πÄ‡∏£‡πá‡∏ß‡πÅ‡∏•‡∏∞‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥</p>
            <div class="tips">
                üí° ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏î‡πâ‡∏ß‡∏¢‡∏´‡∏•‡∏≤‡∏¢‡∏Ñ‡∏≥‡πÑ‡∏î‡πâ ‡πÄ‡∏ä‡πà‡∏ô "ABB C32" ‡∏´‡∏£‡∏∑‡∏≠ "schneider 25A"
            </div>
        </div>

        <!-- Setup Box -->
        <div class="setup-box" id="setupBox">
            <div class="setup-title">‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å</div>
            
            <div class="instructions">
                <h4>üìã ‡∏ß‡∏¥‡∏ò‡∏µ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Google Sheets:</h4>
                <ol>
                    <li>‡πÄ‡∏õ‡∏¥‡∏î Google Sheets ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</li>
                    <li>‡∏Ñ‡∏•‡∏¥‡∏Å <strong>‡∏™‡πà‡∏ß‡∏ô‡∏Ç‡∏¢‡∏≤‡∏¢ ‚Üí Apps Script</strong></li>
                    <li>‡∏•‡∏ö‡πÇ‡∏Ñ‡πâ‡∏î‡πÄ‡∏î‡∏¥‡∏°‡∏≠‡∏≠‡∏Å ‡πÅ‡∏•‡πâ‡∏ß‡∏ß‡∏≤‡∏á‡πÇ‡∏Ñ‡πâ‡∏î‡∏ô‡∏µ‡πâ:
<pre>function doGet(e) {
  var sheet = SpreadsheetApp
    .getActiveSpreadsheet()
    .getActiveSheet();
  var data = sheet.getDataRange().getValues();
  var json = JSON.stringify(data);

  // ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö JSONP (‡πÅ‡∏Å‡πâ‡∏õ‡∏±‡∏ç‡∏´‡∏≤ CORS ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡∏à‡∏≤‡∏Å file://)
  var callback = e && e.parameter && e.parameter.callback;
  if (callback) {
    return ContentService
      .createTextOutput(callback + '(' + json + ')')
      .setMimeType(ContentService.MimeType.JAVASCRIPT);
  }

  return ContentService
    .createTextOutput(json)
    .setMimeType(ContentService.MimeType.JSON);
}</pre>
                    </li>
                    <li>‡∏Ñ‡∏•‡∏¥‡∏Å <strong>‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ ‚Üí ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡πÉ‡∏´‡∏°‡πà</strong></li>
                    <li>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å <strong>‡πÄ‡∏ß‡πá‡∏ö‡πÅ‡∏≠‡∏õ</strong></li>
                    <li>‡∏ú‡∏π‡πâ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á: ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å <strong>"‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô"</strong></li>
                    <li>‡∏Ñ‡∏•‡∏¥‡∏Å <strong>‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ</strong></li>
                    <li>‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å <strong>URL ‡∏Ç‡∏≠‡∏á‡πÄ‡∏ß‡πá‡∏ö‡πÅ‡∏≠‡∏õ</strong></li>
                    <li>‡∏ß‡∏≤‡∏á URL ‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á</li>
                </ol>
            </div>

            <div class="input-group">
                <label>üîó URL ‡∏Ç‡∏≠‡∏á Google Apps Script:</label>
                <input 
                    type="text" 
                    id="sheetUrl" 
                    placeholder="https://script.google.com/macros/s/xxxxx/exec"
                >
            </div>

            <button class="btn" onclick="loadFromGoogleSheets()">
                üöÄ ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÅ‡∏•‡∏∞‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
            </button>

            <div id="statusMessage"></div>
        </div>

        <!-- Search Box -->
        <div class="search-box" id="searchBox">
            <div class="search-input-wrapper">
                <input 
                    type="text" 
                    id="searchInput" 
                    placeholder="üîé ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ ‡πÄ‡∏ä‡πà‡∏ô ABB C32, schneider contactor, ‡πÑ‡∏ü LED..."
                    autocomplete="off"
                >
                <span class="search-icon">üîç</span>
            </div>
            
            <div class="stats">
                <div class="stat-card">
                    <div class="number" id="foundProducts">0</div>
                    <div class="label">‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</div>
                </div>
                <div class="stat-card">
                    <div class="number" id="totalProducts">0</div>
                    <div class="label">‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
                </div>
            </div>

            <div style="text-align: center;">
                <button class="btn refresh-btn" onclick="refreshData()">
                    üîÑ ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                </button>
            </div>
        </div>

        <!-- Results -->
        <div id="results" class="results"></div>
    </div>

    <script>
        let products = [];

        // JSONP ‚Äî ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤ CORS ‡πÅ‡∏°‡πâ‡πÄ‡∏õ‡∏¥‡∏î‡∏à‡∏≤‡∏Å file://
        function fetchWithJSONP(url) {
            return new Promise((resolve, reject) => {
                const cbName = 'cb_' + Date.now();
                const script = document.createElement('script');
                const timer = setTimeout(() => {
                    cleanup();
                    reject(new Error('JSONP timeout'));
                }, 10000);

                function cleanup() {
                    clearTimeout(timer);
                    delete window[cbName];
                    if (script.parentNode) script.parentNode.removeChild(script);
                }

                window[cbName] = function(data) {
                    cleanup();
                    resolve(JSON.stringify(data));
                };

                // Apps Script ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö ?callback= ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö JSONP
                script.src = url + (url.includes('?') ? '&' : '?') + 'callback=' + cbName;
                script.onerror = () => { cleanup(); reject(new Error('JSONP script error')); };
                document.head.appendChild(script);
            });
        }

        async function loadFromGoogleSheets() {
            const url = document.getElementById('sheetUrl').value.trim();
            
            if (!url) {
                showStatus('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà URL ‡∏Ç‡∏≠‡∏á Google Apps Script', 'error');
                return;
            }

            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö URL ‡∏Å‡πà‡∏≠‡∏ô
            const urlCheck = checkUrlFormat(url);
            if (!urlCheck.valid) {
                showStatus(urlCheck.message, 'error');
                showDiagnostic(urlCheck.detail);
                return;
            }

            showStatus('‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠...', 'info');
            document.getElementById('results').innerHTML = '<div class="loading"><div class="spinner"></div><div>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</div></div>';

            try {
                let responseText = null;

                // ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà 1: JSONP ‚Äî ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡πÅ‡∏°‡πâ‡πÄ‡∏õ‡∏¥‡∏î‡∏à‡∏≤‡∏Å file://
                try {
                    responseText = await fetchWithJSONP(url);
                } catch(e1) { console.log('JSONP failed:', e1); }

                // ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà 2: fetch ‡∏ï‡∏£‡∏á
                if (!responseText) {
                    try {
                        const r = await fetch(url);
                        if (r.ok) responseText = await r.text();
                    } catch(e2) { console.log('Direct fetch failed:', e2); }
                }

                // ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà 3: CORS Proxy ‡∏™‡∏≥‡∏£‡∏≠‡∏á
                if (!responseText) {
                    for (const proxy of ['https://corsproxy.io/?', 'https://api.allorigins.win/raw?url=']) {
                        try {
                            const r = await fetch(proxy + encodeURIComponent(url));
                            if (r.ok) { responseText = await r.text(); break; }
                        } catch(e3) {}
                    }
                }

                if (!responseText) throw new Error('‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ');

                // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Å‡πà‡∏≠‡∏ô parse
                const dataCheck = checkResponseData(responseText);
                if (!dataCheck.valid) {
                    showStatus(dataCheck.message, 'error');
                    showDiagnostic(dataCheck.detail);
                    document.getElementById('results').innerHTML = '';
                    return;
                }

                parseData(responseText);
                localStorage.setItem('sheetUrl', url);
                document.getElementById('setupBox').style.display = 'none';
                document.getElementById('searchBox').classList.add('active');

                if (products.length > 0) {
                    showStatus(`‚úÖ ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏û‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ ${products.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`, 'success');
                    hideDiagnostic();
                    setTimeout(() => { document.getElementById('statusMessage').innerHTML = ''; }, 3000);
                } else {
                    showStatus('‚ö†Ô∏è ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡πÅ‡∏ï‡πà‡∏û‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ 0 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£', 'error');
                    const headers = dataCheck.headers || [];
                    showDiagnostic({
                        title: 'üîç ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö:',
                        items: [
                            `‚úÖ ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ URL ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à`,
                            `‚úÖ ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Google Sheets ‡πÅ‡∏•‡πâ‡∏ß`,
                            `‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ ‚Äî ‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏≠‡∏≤‡∏à‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á`,
                            ``,
                            `üìã ‡∏´‡∏±‡∏ß‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏ó‡∏µ‡πà‡∏û‡∏ö‡πÉ‡∏ô Sheets: ${headers.length > 0 ? headers.join(' | ') : '(‡πÑ‡∏°‡πà‡∏û‡∏ö)'}`,
                            ``,
                            `‚ö†Ô∏è ‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏ä‡∏∑‡πà‡∏≠:`,
                            `   ‚Ä¢ ProductID (‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤)`,
                            `   ‚Ä¢ ProductName (‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤)`,
                            ``,
                            `üí° ‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ: ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡πÅ‡∏ñ‡∏ß‡πÅ‡∏£‡∏Å‡πÉ‡∏ô Google Sheets`
                        ]
                    });
                }
                
            } catch (error) {
                showStatus('‚ùå ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ', 'error');
                showDiagnostic({
                    title: 'üîç ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö:',
                    items: [
                        `‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ URL ‡πÑ‡∏î‡πâ`,
                        ``,
                        `üí° ‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç:`,
                        `   1. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ URL ‡∏Ç‡∏∂‡πâ‡∏ô‡∏ï‡πâ‡∏ô‡∏î‡πâ‡∏ß‡∏¢ https://script.google.com/`,
                        `   2. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ Deploy ‡πÅ‡∏•‡πâ‡∏ß ‡πÅ‡∏•‡∏∞‡πÄ‡∏•‡∏∑‡∏≠‡∏Å "‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô" ‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á`,
                        `   3. ‡∏•‡∏≠‡∏á Deploy ‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÉ‡∏ô Apps Script`
                    ]
                });
                document.getElementById('results').innerHTML = '';
            }
        }

        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö URL
        function checkUrlFormat(url) {
            if (url.includes('script.google.com/macros/s/') && url.endsWith('/exec')) {
                return { valid: true };
            }
            if (url.includes('docs.google.com/spreadsheets')) {
                return {
                    valid: false,
                    message: '‚ùå URL ‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡∏≠‡∏á Google Sheets ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà Apps Script',
                    detail: {
                        title: 'üîç ‡∏û‡∏ö‡∏õ‡∏±‡∏ç‡∏´‡∏≤: ‡πÉ‡∏™‡πà URL ‡∏ú‡∏¥‡∏î‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó',
                        items: [
                            '‚ùå URL ‡∏ó‡∏µ‡πà‡πÉ‡∏™‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡∏≠‡∏á Google Sheets ‡πÉ‡∏ä‡πâ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ',
                            '‚úÖ ‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ URL ‡∏à‡∏≤‡∏Å Apps Script ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô',
                            '',
                            'üìã ‡∏ß‡∏¥‡∏ò‡∏µ‡∏´‡∏≤ URL ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á:',
                            '   1. ‡πÄ‡∏õ‡∏¥‡∏î Google Sheets ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì',
                            '   2. ‡∏Ñ‡∏•‡∏¥‡∏Å "‡∏™‡πà‡∏ß‡∏ô‡∏Ç‡∏¢‡∏≤‡∏¢" ‚Üí "Apps Script"',
                            '   3. ‡∏ß‡∏≤‡∏á‡πÇ‡∏Ñ‡πâ‡∏î doGet() ‚Üí Save',
                            '   4. "‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ" ‚Üí "‡πÄ‡∏ß‡πá‡∏ö‡πÅ‡∏≠‡∏õ" ‚Üí "‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô"',
                            '   5. ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å URL ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ',
                            '',
                            '‚úÖ URL ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö:',
                            '   https://script.google.com/macros/s/xxxxx/exec'
                        ]
                    }
                };
            }
            if (!url.startsWith('https://script.google.com')) {
                return {
                    valid: false,
                    message: '‚ùå URL ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á',
                    detail: {
                        title: 'üîç ‡∏û‡∏ö‡∏õ‡∏±‡∏ç‡∏´‡∏≤: ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö URL ‡∏ú‡∏¥‡∏î',
                        items: [
                            `‚ùå URL ‡∏ó‡∏µ‡πà‡πÉ‡∏™‡πà: ${url.substring(0, 60)}`,
                            '',
                            '‚úÖ URL ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö:',
                            '   https://script.google.com/macros/s/xxxxx/exec',
                            '',
                            'üí° URL ‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏î‡πâ‡∏°‡∏≤‡∏à‡∏≤‡∏Å Apps Script ‚Üí Deploy ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô'
                        ]
                    }
                };
            }
            return { valid: true };
        }

        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö
        function checkResponseData(text) {
            if (text.trim().startsWith('<')) {
                return {
                    valid: false,
                    message: '‚ùå Script ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï ‚Äî ‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏±‡πâ‡∏á‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÉ‡∏´‡∏°‡πà',
                    headers: [],
                    detail: {
                        title: 'üîç ‡∏û‡∏ö‡∏õ‡∏±‡∏ç‡∏´‡∏≤: Script ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï',
                        items: [
                            '‚ùå Script ‡∏™‡πà‡∏á Error Page ‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤',
                            '   ‚Üí ‡πÄ‡∏Å‡∏¥‡∏î‡∏à‡∏≤‡∏Å‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á',
                            '',
                            'üí° ‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç ‚Äî Deploy ‡πÉ‡∏´‡∏°‡πà:',
                            '   1. ‡πÄ‡∏õ‡∏¥‡∏î Apps Script',
                            '   2. "‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ" ‚Üí "‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ"',
                            '   3. ‡∏Ñ‡∏•‡∏¥‡∏Å‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô ‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç',
                            '   4. "‡∏ú‡∏π‡πâ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á" ‚Üí ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô "‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô"',
                            '   5. ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å ‚Üí ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å URL ‡πÉ‡∏´‡∏°‡πà‡∏°‡∏≤‡πÉ‡∏™‡πà'
                        ]
                    }
                };
            }
            try {
                const json = JSON.parse(text);
                if (Array.isArray(json) && json.length > 0) {
                    return { valid: true, headers: json[0] };
                }
                if (Array.isArray(json) && json.length === 0) {
                    return {
                        valid: false,
                        message: '‚ùå Google Sheets ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•',
                        headers: [],
                        detail: {
                            title: 'üîç ‡∏û‡∏ö‡∏õ‡∏±‡∏ç‡∏´‡∏≤: Sheet ‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏õ‡∏•‡πà‡∏≤',
                            items: [
                                '‚ùå ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏õ‡∏•‡πà‡∏≤‡∏°‡∏≤‡∏à‡∏≤‡∏Å Google Sheets',
                                'üí° ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ Sheet ‡∏ó‡∏µ‡πà Deploy ‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏≠‡∏¢‡∏π‡πà',
                                '   ‚Üí Apps Script ‡πÉ‡∏ä‡πâ getActiveSheet() = ‡∏ä‡∏µ‡∏ó‡πÅ‡∏£‡∏Å‡πÄ‡∏™‡∏°‡∏≠'
                            ]
                        }
                    };
                }
            } catch (e) { /* ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà JSON ‡πÉ‡∏´‡πâ parse CSV ‡∏ï‡πà‡∏≠ */ }
            return { valid: true, headers: [] };
        }

        // ‡πÅ‡∏™‡∏î‡∏á / ‡∏ã‡πà‡∏≠‡∏ô ‡∏Å‡∏•‡πà‡∏≠‡∏á Diagnostic
        function showDiagnostic(detail) {
            let box = document.getElementById('diagnosticBox');
            if (!box) {
                box = document.createElement('div');
                box.id = 'diagnosticBox';
                box.style.cssText = `background:#fff8e1;border:2px solid #ffc107;border-radius:12px;
                    padding:20px;margin-top:15px;font-size:14px;line-height:2;`;
                document.getElementById('statusMessage').insertAdjacentElement('afterend', box);
            }
            box.innerHTML = `<strong style="color:#856404;font-size:15px;">${detail.title}</strong><br><br>` +
                detail.items.map(item => item === '' ? '<br>' : `<span style="font-family:monospace;">${item}</span><br>`).join('');
        }

        function hideDiagnostic() {
            const box = document.getElementById('diagnosticBox');
            if (box) box.remove();
        }

        function refreshData() {
            const url = localStorage.getItem('sheetUrl');
            if (url) {
                document.getElementById('sheetUrl').value = url;
                loadFromGoogleSheets();
            }
        }

        function parseData(text) {
            try {
                const jsonData = JSON.parse(text);
                if (Array.isArray(jsonData)) {
                    parseJSONData(jsonData);
                    return;
                }
            } catch (e) {
                parseCSVData(text);
            }
        }

        function parseCSVData(csvText) {
            const lines = csvText.split('\n').filter(line => line.trim());
            if (lines.length === 0) {
                showStatus('‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå', 'error');
                return;
            }

            const headers = parseCSVLine(lines[0]);
            const indices = findColumnIndices(headers);

            products = [];
            
            for (let i = 1; i < lines.length; i++) {
                const values = parseCSVLine(lines[i]);
                if (values.length <= 1) continue;
                
                const product = {
                    id: (values[indices.id] || '').toString().trim(),
                    name: (values[indices.name] || '').toString().trim(),
                    brand: (values[indices.brand] || '-').toString().trim(),
                    category: (values[indices.category] || '-').toString().trim(),
                    price: parseFloat((values[indices.price] || '0').toString().replace(/,/g, '')) || 0,
                    quantity: parseInt((values[indices.quantity] || '0').toString().replace(/,/g, '')) || 0,
                    imageUrl: (values[indices.imageUrl] || '').toString().trim()
                };
                
                if (product.id && product.name) {
                    products.push(product);
                }
            }

            document.getElementById('totalProducts').textContent = products.length;
            displayProducts(products);
            
            if (products.length === 0) {
                showStatus('‚ö†Ô∏è ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ - ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡πÉ‡∏ô Google Sheets', 'error');
            }
        }

        function parseJSONData(jsonData) {
            if (jsonData.length === 0) {
                showStatus('‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå', 'error');
                return;
            }
            
            const headers = jsonData[0];
            const indices = findColumnIndices(headers);

            products = [];
            
            for (let i = 1; i < jsonData.length; i++) {
                const row = jsonData[i];
                if (!row || row.length === 0) continue;
                
                const product = {
                    id: (row[indices.id] || '').toString().trim(),
                    name: (row[indices.name] || '').toString().trim(),
                    brand: (row[indices.brand] || '-').toString().trim(),
                    category: (row[indices.category] || '-').toString().trim(),
                    price: parseFloat(row[indices.price]) || 0,
                    quantity: parseInt(row[indices.quantity]) || 0,
                    imageUrl: (row[indices.imageUrl] || '').toString().trim()
                };
                
                if (product.id && product.name) {
                    products.push(product);
                }
            }

            document.getElementById('totalProducts').textContent = products.length;
            displayProducts(products);
            
            if (products.length === 0) {
                showStatus('‚ö†Ô∏è ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ - ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡πÉ‡∏ô Google Sheets', 'error');
            }
        }

        function findColumnIndices(headers) {
            const headerLower = headers.map(h => h.toString().toLowerCase());
            
            return {
                id: headerLower.findIndex(h => 
                    h.includes('productid') || h === 'id' || h.includes('‡∏£‡∏´‡∏±‡∏™') || h.includes('‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤')
                ),
                name: headerLower.findIndex(h => 
                    h.includes('productname') || h.includes('name') || h.includes('‡∏ä‡∏∑‡πà‡∏≠') || h.includes('‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤')
                ),
                brand: headerLower.findIndex(h => 
                    h.includes('brand') || h.includes('‡∏¢‡∏µ‡πà‡∏´‡πâ‡∏≠') || h.includes('‡πÅ‡∏ö‡∏£‡∏ô‡∏î‡πå')
                ),
                category: headerLower.findIndex(h => 
                    h.includes('category') || h.includes('‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà') || h.includes('‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó')
                ),
                price: headerLower.findIndex(h => 
                    h.includes('sellprice') || h.includes('‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢') || h.includes('installedsellprice') || (h.includes('price') && !h.includes('cost')) || h.includes('‡∏£‡∏≤‡∏Ñ‡∏≤')
                ),
                quantity: headerLower.findIndex(h => 
                    h.includes('quantity') || h.includes('‡∏à‡∏≥‡∏ô‡∏ß‡∏ô') || h.includes('‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠') || h.includes('stock')
                ),
                imageUrl: headerLower.findIndex(h => 
                    h.includes('imageurl') || h.includes('image') || h.includes('‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û') || h.includes('img')
                )
            };
        }

        function parseCSVLine(line) {
            const result = [];
            let current = '';
            let inQuotes = false;
            
            for (let i = 0; i < line.length; i++) {
                const char = line[i];
                
                if (char === '"') {
                    inQuotes = !inQuotes;
                } else if (char === ',' && !inQuotes) {
                    result.push(current.trim().replace(/^"|"$/g, ''));
                    current = '';
                } else {
                    current += char;
                }
            }
            result.push(current.trim().replace(/^"|"$/g, ''));
            
            return result;
        }

        function showStatus(message, type) {
            const statusDiv = document.getElementById('statusMessage');
            statusDiv.innerHTML = `<div class="status-message status-${type}">${message}</div>`;
        }

        function searchProducts(query) {
            if (!query.trim()) {
                displayProducts(products);
                return;
            }

            const searchTerms = query.toLowerCase()
                .split(/\s+/)
                .filter(term => term.length > 0);

            const filtered = products.filter(product => {
                const searchableText = [
                    product.id,
                    product.name,
                    product.brand,
                    product.category
                ].join(' ').toLowerCase();

                return searchTerms.every(term => searchableText.includes(term));
            });

            displayProducts(filtered);
        }

        function displayProducts(productList) {
            const resultsDiv = document.getElementById('results');
            const foundCount = document.getElementById('foundProducts');
            
            foundCount.textContent = productList.length;

            if (productList.length === 0) {
                resultsDiv.innerHTML = `
                    <div class="no-results">
                        <div class="no-results-icon">üòî</div>
                        <div>‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</div>
                        <div style="font-size: 14px; margin-top: 10px; opacity: 0.8;">‡∏•‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏≠‡∏∑‡πà‡∏ô‡∏î‡∏π‡∏ô‡∏∞‡∏Ñ‡∏∞</div>
                    </div>
                `;
                return;
            }

            resultsDiv.innerHTML = productList.map(product => `
                <div class="product-card">
                    ${product.imageUrl ? `
                        <div class="product-image">
                            <img src="${product.imageUrl}" alt="${product.name}" loading="lazy" onerror="this.parentElement.innerHTML='<div style=\\'padding:60px;font-size:48px;\\'>üì¶</div>'">
                        </div>
                    ` : `
                        <div class="product-image no-image">
                            <div style="font-size: 48px;">üì¶</div>
                        </div>
                    `}
                    <div class="product-body">
                        <div class="product-header">
                            <div class="product-name">${product.name}</div>
                            <span class="product-id">‡∏£‡∏´‡∏±‡∏™: ${product.id}</span>
                        </div>
                        <div class="product-info">
                            ${product.brand !== '-' ? `
                            <div class="info-row">
                                <span class="info-label">‡∏¢‡∏µ‡πà‡∏´‡πâ‡∏≠</span>
                                <span class="brand-badge">${product.brand}</span>
                            </div>
                            ` : ''}
                            ${product.category !== '-' ? `
                            <div class="info-row">
                                <span class="info-label">‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</span>
                                <span class="category-badge">${product.category}</span>
                            </div>
                            ` : ''}
                            ${product.quantity > 0 ? `
                            <div class="info-row">
                                <span class="info-label">‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</span>
                                <span class="quantity-badge">${product.quantity.toLocaleString('th-TH')} ‡∏ä‡∏¥‡πâ‡∏ô</span>
                            </div>
                            ` : ''}
                            <div class="info-row">
                                <span class="info-label">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢</span>
                                <span class="info-value price">${product.price > 0 ? product.price.toLocaleString('th-TH', {minimumFractionDigits: 0, maximumFractionDigits: 2}) + ' ‡∏ø' : '‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏™‡∏≠‡∏ö‡∏ñ‡∏≤‡∏°'}</span>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        document.getElementById('searchInput').addEventListener('input', (e) => {
            searchProducts(e.target.value);
        });

        window.addEventListener('load', () => {
            const savedUrl = localStorage.getItem('sheetUrl');
            if (savedUrl) {
                document.getElementById('sheetUrl').value = savedUrl;
                document.getElementById('setupBox').style.display = 'none';
                document.getElementById('searchBox').classList.add('active');
                loadFromGoogleSheets();
            }
        });
    </script>
</body>
</html>